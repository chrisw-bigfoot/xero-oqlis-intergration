{% extends "core/base.html" %}
{% load static %}

{% block title %}Import Details{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-8">
            <h1 class="mb-4">
                <i class="fas fa-clipboard-check me-2"></i>
                Import Details
            </h1>

            <!-- Status Alert -->
            <div class="alert 
                {% if import.status == 'completed' %}alert-success{% elif import.status == 'failed' %}alert-danger{% elif import.status == 'processing' %}alert-info{% else %}alert-warning{% endif %} 
                alert-dismissible fade show" role="alert">
                <div class="row align-items-center">
                    <div class="col-auto">
                        {% if import.status == 'completed' %}
                            <i class="fas fa-check-circle fa-2x"></i>
                        {% elif import.status == 'failed' %}
                            <i class="fas fa-times-circle fa-2x"></i>
                        {% elif import.status == 'processing' %}
                            <i class="fas fa-spinner fa-spin fa-2x"></i>
                        {% else %}
                            <i class="fas fa-hourglass-half fa-2x"></i>
                        {% endif %}
                    </div>
                    <div class="col">
                        <h5 class="alert-heading mb-1 text-capitalize">
                            {{ import.get_status_display }}
                        </h5>
                        <p class="mb-0">
                            Uploaded on {{ import.created_at|date:"F d, Y \a\t H:i" }}
                        </p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <!-- Import Information -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title text-muted">
                                <i class="fas fa-building me-2"></i>
                                Legal Entity
                            </h6>
                            <p class="card-text">
                                <strong>{{ import.legal_entity.name }}</strong>
                            </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card shadow-sm">
                        <div class="card-body">
                            <h6 class="card-title text-muted">
                                <i class="fas fa-list me-2"></i>
                                Dataset Type
                            </h6>
                            <p class="card-text">
                                <strong>{{ import.dataset_type.display_name }}</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Information -->
            <div class="card mb-4 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-file me-2"></i>
                        File Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted">File Name</h6>
                            <p><strong>{{ import.file_name }}</strong></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted">File Size</h6>
                            <p><strong>{{ import.file.size|filesizeformat }}</strong></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted">Uploaded By</h6>
                            <p><strong>{{ import.created_by.first_name }} {{ import.created_by.last_name }}</strong></p>
                        </div>
                        <div class="col-md-6 mb-3">
                            <h6 class="text-muted">Upload Date</h6>
                            <p><strong>{{ import.created_at|date:"F d, Y H:i" }}</strong></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Processing Information -->
            {% if import.status == 'completed' or import.status == 'processing' or import.status == 'failed' %}
                <div class="card shadow-sm">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-chart-bar me-2"></i>
                            Processing Results
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <h6 class="text-muted">Rows Processed</h6>
                                <p class="display-6 text-primary mb-0">{{ import.rows_processed }}</p>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-muted">Processing Date</h6>
                                <p>
                                    {% if import.processed_at %}
                                        {{ import.processed_at|date:"F d, Y H:i" }}
                                    {% else %}
                                        <span class="text-muted">In progress...</span>
                                    {% endif %}
                                </p>
                            </div>
                        </div>

                        {% if import.error_message %}
                            <div class="alert alert-danger mt-3">
                                <h6 class="alert-heading">Error Message</h6>
                                <p class="mb-0">{{ import.error_message }}</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- Sidebar -->
        <div class="col-md-4">
            <!-- Status Timeline -->
            <div class="card sticky-top mt-5 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-tasks me-2"></i>
                        Status Timeline
                    </h5>
                    <div class="timeline">
                        <div class="timeline-item {% if import.status == 'pending' or import.status == 'processing' or import.status == 'completed' or import.status == 'failed' %}completed{% endif %}">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h6>File Uploaded</h6>
                                <small class="text-muted">{{ import.created_at|date:"M d, Y H:i" }}</small>
                            </div>
                        </div>
                        <div class="timeline-item {% if import.status == 'processing' or import.status == 'completed' or import.status == 'failed' %}completed{% endif %}">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h6>Processing Started</h6>
                                <small class="text-muted">
                                    {% if import.status == 'processing' or import.status == 'completed' or import.status == 'failed' %}
                                        In progress...
                                    {% else %}
                                        Pending...
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                        <div class="timeline-item {% if import.status == 'completed' %}completed{% endif %}">
                            <div class="timeline-marker"></div>
                            <div class="timeline-content">
                                <h6>Processing Completed</h6>
                                <small class="text-muted">
                                    {% if import.processed_at %}
                                        {{ import.processed_at|date:"M d, Y H:i" }}
                                    {% else %}
                                        Pending...
                                    {% endif %}
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card mt-4 shadow-sm">
                <div class="card-body">
                    <h5 class="card-title">Actions</h5>
                    <div class="d-grid gap-2">
                        <a href="{% url 'start_import' %}" class="btn btn-primary">
                            <i class="fas fa-plus-circle me-2"></i>
                            New Import
                        </a>
                        <a href="{% url 'import_history' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-history me-2"></i>
                            View History
                        </a>
                        <a href="{% url 'legal_entities_list' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-building me-2"></i>
                            Legal Entities
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.timeline {
    position: relative;
    padding: 20px 0;
}

.timeline-item {
    display: flex;
    margin-bottom: 30px;
    opacity: 0.6;
}

.timeline-item.completed {
    opacity: 1;
}

.timeline-marker {
    width: 12px;
    height: 12px;
    background-color: #dee2e6;
    border-radius: 50%;
    margin-right: 15px;
    margin-top: 4px;
    flex-shrink: 0;
}

.timeline-item.completed .timeline-marker {
    background-color: #28a745;
}

.timeline-content h6 {
    margin-bottom: 4px;
    font-weight: 600;
}
</style>
{% endblock %}
